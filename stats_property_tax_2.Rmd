---
title: "Statistics on Gentrification"
author: "Fernando Garcia - Drazzel Feliu"
date: "8/25/2020"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(lubridate)
library(ggmap)
library(tidycensus)
library(mapview)
library(sf)
library(leaflet)
library(viridis)
library(maps)
library(htmlwidgets)
library(htmltools)
library(tigris)
library(reshape2)
library(ggrepel)
library(ggmap)

rm(list = ls())
```

```{r, warning=FALSE, error=FALSE}

census <- readRDS("census.RDS")

```

Checking summary statistics:

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(income_pc_18=agg_income_18/population_18) %>%
  summarise(mean_income_pc_18=mean(income_pc_18,na.rm=T))

census %>%
  summarise(mean_avg_household_size_18 = mean(avg_household_size_18,na.rm=T))

census %>%
  mutate(income_household_18=(agg_income_18/population_18) * 
           avg_household_size_18) %>%
  summarise(median_income_household_18=median(income_household_18,na.rm=T))

census %>%
  summarise(median_income_18=median(income_18,na.rm=T))

census %>%
  summarise(median_rent_18=median(median_rent_18,na.rm=T))

```

Mean income per capita for 2018 is $33,599. Median household income is \$68,000 with an average household size of 2.6. Correct if we look at https://www.census.gov/quickfacts/fact/table/chicagocityillinois/LND110210.

Summary statistics for 2013:

```{r, warning=FALSE, error=FALSE}

census %>%
  mutate(income_pc_13=agg_income_13/population_13) %>%
  summarise(mean_income_pc_13=mean(income_pc_13,na.rm=T))

census %>%
  summarise(mean_avg_household_size_13=mean(avg_household_size_13,na.rm=T))

census %>%
  mutate(income_household_13=(agg_income_13/population_13) * 
           avg_household_size_13) %>%
  summarise(median_income_household_13=median(income_household_13,na.rm=T))

```

Median household income is \$ 58,676.28 and per capita income mean is \$28,747.67 in 2013.


#Gentrification:

Distribution of home values in 2018:

```{r}

census %>%
  summarise(median_value_18=median(value_18, na.rm=T))

ggplot(census) +
  geom_histogram(aes(x = value_18, y = ..density..),
    binwidth = 10000,
    colour = "black", fill = "white"
  )  +
  geom_vline(xintercept = 226800, color="blue") +
  ggtitle("Histogram price increase in home values")

``` 

Distribution of home value increase:

```{r}

census %>%
  summarise(median_value_18=median(value_18, na.rm=T))

ggplot(census) +
  geom_histogram(aes(x = increase_value, y = ..density..),
    binwidth = 1,
    colour = "black", fill = "white"
  ) +
  geom_vline(xintercept = 4.334484, color="blue") +
  ggtitle("Histogram price icnrease home values")

``` 

We will zoom in to look at the outliers:

```{r}
ggplot(census) +
  geom_histogram(aes(x = increase_value, y = ..density..),
    binwidth = 1,
    colour = "black", fill = "white"
  ) +
  xlim(c(25, 200)) +
  ggtitle("Histogram price increase in home values")

``` 

```{r, warning=FALSE, error=FALSE}
census_rest <- census %>%
  filter(increase_value > 0)

plot(ecdf(census_rest$increase_value), 
     xlab="Home value price increase ($)",
     ylab="Cumulative Distribution",
     main="Home value price increase distributions from 2013-2018")
abline(h=0.95, col="blue")
```


The cumulative distribution looks like this:

```{r, warning=FALSE, error=FALSE}
homeincrease = census_rest$increase_value

quantile(homeincrease, c(.8, .85, .9, .95))
```

The last 10% of the distribution gets a 36% or more of an increase in home values. We can use this to define gentrification.

#First definition of gentrification

We use the 90th percentile of the home value increase 

```{r, warning=FALSE, error=FALSE}
census <- census %>%
  mutate(gentri_1 = case_when(
    increase_value > 36 & value_18 > 180800 ~ 1,
    increase_value > 25 & value_18 > 226000 ~ 1,
    increase_value <= 36 & (value_18 > 180800 & value_18 < 226000) ~ 0,
    (increase_value > 25 & increase_value <= 36) & value_18 <= 226000 ~ 0,
    increase_value <= 25 ~ 0,
    value_18 <= 180800 ~ 0
    )
  )
```

```{r, warning=FALSE, error=FALSE}

census %>%
  filter(gentri_1==1) %>%
  count()

```

This measure of gentrification reaches 76 tracts.


#Second definition of gentrification:

```{r, warning=FALSE, error=FALSE}

census <- census %>%
  mutate(gentri_2 = case_when(
    increase_value > 36 & household_income_13 <= 58676 ~ 1,
    increase_value > 25 & household_income_13 <= 46900 ~1,
    (increase_value > 25 & increase_value <= 36) & 
      (household_income_13 > 46900 & household_income_13 < 58676) ~ 0,
    increase_value <= 25 ~ 0,
    household_income_13 > 58676 ~ 0
    )
  )

```

```{r, warning=FALSE, error=FALSE}

census %>%
  filter(gentri_2==1) %>%
  count()

```

This measure of gentrification reaches 35 tracts.

#Gentrification definition according to Brummet, Reed, 2019. 

```{r, warning=FALSE, error=FALSE}
census <- census %>%
  mutate(gentri_3 = (bc_18  - bc_13) / population_13)

```

```{r}

census %>%
  summarise(median_gentri_3=median(gentri_3, na.rm=T))

ggplot(census) +
  geom_histogram(aes(x = gentri_3, y = ..density..),
    colour = "black", fill = "white"
  )  +
  geom_vline(xintercept = 0.02742509, color="blue") +
  ggtitle("Histogram price increase in home values")

``` 

What is the 90th percentile of the gentrification's indicator:

```{r, warning=FALSE, error=FALSE}
gentrification = census$gentri_3

quantile(gentrification, c(.8, .85, .90, .95), na.rm = T) 
```

We create a dummy variable if gentrification is beyond the 90th percentile of this indicator:

```{r, warning=FALSE, error=FALSE}

#census %>%
  #summarise(median_income_13=median(household_income_13, na.rm = T))

census <- census %>%
  mutate(one_gentri_3 = case_when(
    gentri_3 >= 0.1146914 & household_income_13 < 58676 ~ 1,
    household_income_13 > 58676 ~ 0,
    gentri_3 < 0.1146914 ~ 0
    )
  )
```

```{r, warning=FALSE, error=FALSE}
census %>%
  filter(one_gentri_3==1) %>%
  count()
```

This measure of gentrification reaches 22 tracts.



Gentrification definition number 4 using racial data:

```{r, warning=FALSE, error=FALSE}

census <- census %>%
  mutate(gentri_4 = (white_not_latino_18  - white_not_latino_13) / sum_13)

```


```{r}

#census %>%
  #summarise(median_gentri_4=median(gentri_4, na.rm=T))

ggplot(census) +
  geom_histogram(aes(x = gentri_4, y = ..density..),
    colour = "black", fill = "white"
  )  +
  geom_vline(xintercept = 0.002240093, color="blue") +
  ggtitle("Histogram price increase in home values")

``` 

What is the 90th percentile of the gentrification's indicator:

```{r, warning=FALSE, error=FALSE}
gentrification = census$gentri_4

quantile(gentrification, c(.8, .85, .90, .95), na.rm = T) 
```

We create a dummy variable if gentrification is beyond the 90th percentile of this indicator:

```{r, warning=FALSE, error=FALSE}

#census %>%
  #summarise(median_income_13=median(household_income_13, na.rm = T))

census <- census %>%
  mutate(one_gentri_4 = case_when(
    gentri_4 >= 0.09571333 & household_income_13 < 58676 ~ 1,
    household_income_13 > 58676 ~ 0,
    gentri_4 < 0.09571333 ~ 0
    )
  )
```

```{r, warning=FALSE, error=FALSE}
census %>%
  filter(one_gentri_4==1) %>%
  count()
```

Definition number 4 reaches 18 tracts.


How many tracts coincide between definition 1 and 2?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = gentri_1*gentri_2) %>%
  filter(common_gent==1) %>%
  count()
```


How many tracts coincide between definition 1 and 3?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = gentri_1*one_gentri_3) %>%
  filter(common_gent==1) %>%
  count()
```

How many tracts coincide between definition 1 and 4?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = gentri_1*one_gentri_4) %>%
  filter(common_gent==1) %>%
  count()
```

How many tracts coincide between definition 2 and 3?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = gentri_2*one_gentri_3) %>%
  filter(common_gent==1) %>%
  count()
```

How many tracts coincide between definition 2 and 4?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = gentri_2*one_gentri_4) %>%
  filter(common_gent==1) %>%
  count()
```


How many tracts coincide between definition 3 and 4?

```{r, warning=FALSE, error=FALSE}
census %>%
  mutate(common_gent = one_gentri_3*one_gentri_4) %>%
  filter(common_gent==1) %>%
  count()
```

```{r, warning=FALSE, error=FALSE}
census <- census %>%
  mutate(common_gent_3_4 = one_gentri_3*one_gentri_4)
```

```{r, warning=FALSE, error=FALSE}
saveRDS(census, file = "census.RDS") 
```


Summary statistics for gentrified areas:


```{r, warning=FALSE, error=FALSE}

census %>%
  filter(gentri_2==1) %>%
  summarise(mean_increase_edu = median(increase_education, na.rm = T))

census %>%
  filter(gentri_2==0) %>%
  summarise(mean_increase_edu = median(increase_education, na.rm = T))

census %>%
  filter(gentri_2==1) %>%
  summarise(mean_increase_bc = median(increase_bachelor, na.rm = T))

census %>%
  filter(gentri_1==0) %>%
  summarise(mean_increase_bc = median(increase_bachelor, na.rm = T))

census %>%
  filter(gentri_2==1) %>%
  summarise(mean_increase_income = mean(increase_income, na.rm = T))

census %>%
  filter(gentri_2==0) %>%
  summarise(mean_increase_income = mean(increase_income, na.rm = T))


```

```{r, warning=FALSE, error=FALSE}
gent <- census
```

```{r, warning=FALSE, error=FALSE}
saveRDS(gent, file = "gent.RDS") 
```
